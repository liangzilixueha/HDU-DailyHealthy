#  杭州电子科技大学每日健康打卡脚本
```
代码惯例：先结论，再细化。先实现，再分析
```

## 首先如何使用，分别有两个使用方法

------



### 第一种方法

- [下载app](hduin-release.apk)
- 在安卓手机上安装，无需打开它，而是长按app

  [^无需长按]: 那是因为我注册了快捷方式，更加便捷

  ，你将看到如下界面，对于非安卓手机，安卓手机api<25(*Android*7.1)的用户，请采用第二种方法

  [^为何采用第二种]: 那是因为过老的安卓不支持这个新功能

  

![qq_pic_merged_1670253643775](image/qq_pic_merged_1670253643775.jpg)

- 现在，请点击“一键打卡”功能，你将看到

  - 申请通知权限

    [^为何要通知权限]: 告诉你打卡成功，所以拒绝也是无妨的

    

  - 未登录跳转提示，一下是跳转结果![Screenshot_2022-12-05-23-22-15-83_059f60b58cabef4](image/Screenshot_2022-12-05-23-22-15-83_059f60b58cabef4.jpg)

  - 现在请登录，再返回

    [^登录]: 这是杭电官网，我无法获取你的账号密码，但是打卡所需要的token是我必须获取的

    

- 再次长按app，点击一键打卡，你将发现，打卡成功！

![Screenshot_2022-12-05-23-26-02-83_b783bf344239542](image/Screenshot_2022-12-05-23-26-02-83_b783bf344239542.jpg)

- 此时你可以打开你的钉钉看看成功与否
------
### 第二种方法

- 打开，并登录https://skl.hduhelp.com/passcard.html#/passcard

  - 你将看到页面跳转，不用担心，这是正常的

- 登陆后按下"F12"，也即"开发者选项",这里我们以windows默认的egde为例子，其他浏览器请自行寻找

- 你将看到如下界面，复制sessionId的值，这很重要

  ![image-20221205233604223](image/image-20221205233604223.png)

- [下载网页](index.html)，当然，不愿意下载的你，也可以访问https://liangzilixueha.github.io/passcard.html    两者是一样的。

- 你会发现孤零零的两个东西

  ![image-20221206001725261](image/image-20221206001725261.png)

- 不要怀疑，填写，然后点击确认！之后看看你的钉钉，是不是已经打卡成功了？

------

## 超级碎碎念(原理部分

- 原理是甚么？

  首先,是打卡的基本流程

  - 通过钉钉获取你的定位
  - 转化定位为城市名字
  - 发送到服务器
  - 当你查询的时候,从服务器拉取

所以你发现,其实有用的是由发送服务器,所以我们通过抓包,知道了发送到服务器的api

```api
https://skl.hdu.edu.cn:443/api/punch
```

此api为POST类型

请求体(Body),json类型

```json
{
	"currentLocation":"浙江省杭州市钱塘区",
	"healthCode":0,
	"city":"杭州市",
	"districtAdcode":"330114",
	"province":"浙江省",
	"district":"钱塘区",
	"healthReport":0,
	"currentLiving":0,
	"last14days":0
}
```

请求头(Headers)

```
X-Auth-Token:你的tokoen
```

用这两个,就可以向发服务器发送请求,你甚至可以发送浙江省华盛顿市!

- 并补充内容

  查询

  ```
  https://skl.hdu.edu.cn:443/api/punch/my
  ```

  GET方法
  
  请求头(Headers)

```
X-Auth-Token:你的tokoen
```

  你就可以获得json类型的返回.

完结撒花*★,°*:.☆(￣▽￣)/$:*.°★* 。